{
  "name": "Add variation to nested variation",
  "input": {
    "newMove": {
      "san": "Qh5",
      "globalIndex": 5000,
      "ply": 5
    },
    "currentMove": {
      "san": "Nc6",
      "globalIndex": 2001,
      "ply": 4,
      "next": {
        "san": "Nf3",
        "globalIndex": 2002,
        "ply": 5
      }
    },
    "history": [
      {
        "san": "e4",
        "globalIndex": 0,
        "ply": 1
      },
      {
        "san": "e5",
        "globalIndex": 1,
        "ply": 2,
        "variations": [
          [
            {
              "san": "d6",
              "globalIndex": 1001,
              "ply": 3
            },
            {
              "san": "d4",
              "globalIndex": 1002,
              "ply": 4,
              "variations": [
                [
                  {
                    "san": "Nc6",
                    "globalIndex": 2001,
                    "ply": 4
                  },
                  {
                    "san": "Nf3",
                    "globalIndex": 2002,
                    "ply": 5
                  }
                ]
              ]
            }
          ]
        ]
      },
      {
        "san": "Nf3",
        "globalIndex": 2,
        "ply": 3
      }
    ]
  },
  "expected": {
    "updatedHistory": [
      {
        "san": "e4",
        "globalIndex": 0,
        "ply": 1
      },
      {
        "san": "e5",
        "globalIndex": 1,
        "ply": 2,
        "variations": [
          [
            {
              "san": "d6",
              "globalIndex": 1001,
              "ply": 3
            },
            {
              "san": "d4",
              "globalIndex": 1002,
              "ply": 4,
              "variations": [
                [
                  {
                    "san": "Nc6",
                    "globalIndex": 2001,
                    "ply": 4
                  },
                  {
                    "san": "Nf3",
                    "globalIndex": 2002,
                    "ply": 5,
                    "variations": [
                      [
                        {
                          "san": "Qh5",
                          "globalIndex": 5000,
                          "ply": 5
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      },
      {
        "san": "Nf3",
        "globalIndex": 2,
        "ply": 3
      }
    ]
  }
}